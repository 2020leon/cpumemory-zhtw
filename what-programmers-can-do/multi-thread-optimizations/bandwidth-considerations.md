# 6.4.3. 頻寬考量

當使用多條執行緒、並且它們不會因為在不同的核心上使用相同的快取行而造成快取爭奪時，仍然會有潛在的問題。每個處理器擁有連接到與這個處理器上所有核心與超執行緒共享的記憶體的最大頻寬。取決於機器架構（如，圖 2.1 中的那個），多個核心可能會共享連結到記憶體或北橋的相同的匯流排。

處理器核心本身即便在完美的情況下全速運轉，到記憶體的連線也無法在不等待的前提下滿足所有載入與儲存的請求。現在，將可用的頻寬進一步以核心、超執行緒、以及共享一條到北橋的連線的處理器的數量劃分，平行突然變成一個大問題。有效率程式的效能可能會受限於可用的記憶體頻寬。

圖 3.32 顯示了增加處理器的 FSB 速度能幫上大忙。這就是為什麼隨著處理器核心數量的成長，我們也會看到 FSB 速度上的提升。儘管如此，若是程式使用了很大的工作集，並且被充分最佳化過了，這也永遠不會足夠。程式設計師必須準備好識別由有限頻寬所致的問題。

現代處理器的效能量測計數器能夠觀察到 FSB 的爭奪。在 Core 2 處理器上，`NUS_BNR_DRV` 事件計算了一顆核心因為匯流排尚未準備就緒而必須等待的週期數。這指出匯流排被重度使用，而且載入或儲存至主記憶體要花費比平常還要更長的時間。Core 2 處理器支援更多事件，能夠計算像 RFO 或一般的 FSB 使用率等特定的匯流排行為。在開發期間研究一個應用程式的可延展性的可能性的時候，後者可能會派上用場。若是匯流排使用率已經接近 1.0 了，可延展性的機會是最小的。

若是識別出一個頻寬問題，有幾件能夠做到的事情。它們有時候是矛盾的，所以某些實驗可能是必要的。一個解法是去買更快的電腦，假如有什麼可買的話。取得更多的 FSB 速度、更快的 RAM 模組、或許還有處理器本地的記憶體，大概––而且很可能會––有幫助。不過，這可能成本高昂。若是程式僅在一台機器（或少數幾台機器）上需要，硬體的一次性開銷可能會比重寫程式的成本還低。不過一般來說，最好是對程式下手。

